(function(a){a.extend({bullet:function(b,d){var n=0;var g=1;var k=2;var c=3;var e={websocket:function(){var f=false;if(window.WebSocket){f=window.WebSocket}if(f){return{heart:true,transport:f}}return false},xhrPolling:function(){var q;var t;var f={readyState:n,ssid:false,send:function(v){if(this.readyState!=g){return false}var u=b.replace("ws:","http:").replace("wss:","https:");if(this.ssid){u+="?s="+this.ssid}a.ajax({async:false,cache:false,type:"POST",url:u,data:v,dataType:"text",contentType:"application/x-www-form-urlencoded; charset=utf-8",headers:{"X-Socket-Transport":"xhrPolling"}});return true},close:function(){this.readyState=c;t.abort();clearTimeout(q);f.onclose()},onopen:function(){},onmessage:function(){},onerror:function(){},onclose:function(){}};var p=function(v,u){if(u=="n"){return"\n"}else{return"\\"}};function r(v,u){var x=v.split("\n");for(i=0;i<x.length;i++){var w=x[i].replace(/\\(n|\\)/g,p);if(w.length>0){u(w)}}}function s(){var u=b.replace("ws:","http:").replace("wss:","https:");if(f.ssid){u+="?s="+f.ssid}t=a.ajax({type:"GET",cache:false,url:u,dataType:"text",data:{},headers:{"X-Socket-Transport":"xhrPolling"},success:function(v){if((f.readyState==g)||(f.readyState==n)){o()}if(f.readyState==n){f.readyState=g;f.ssid=v;f.onopen(f)}else{r(v,function(w){f.onmessage({data:w})})}},error:function(v){if(f.readyState!=c){f.onerror()}}})}function o(){q=setTimeout(function(){s()},500)}s();return{heart:false,transport:function(){return f}}}};var l=0;if(typeof d=="object"){for(var j in d){if(d[j]){d[j]=e[j]}else{delete d[j]}}e=d}function h(){var r=0;for(var q in e){if(l==r){var p=e[q]();if(p){var o=new p.transport(b);o.heart=p.heart;return o}l++}r++}return false}var m=new function(){var t=true;var f=c;var q;var o=delayDefault=80;var p=10000;var s;function r(){t=false;f=n;s=h();if(!s){o=delayDefault;l=0;setTimeout(function(){r()},p);return false}s.onopen=function(){o=delayDefault;if(s.heart){q=setInterval(function(){m.onheartbeat()},20000)}if(f!=g){f=g;m.onopen()}};s.onclose=function(){if(t){return}clearInterval(q);if(f==k){f=c;m.ondisconnect();m.onclose()}else{if(f==n){l++}else{if(f==g){m.ondisconnect()}}o*=2;if(o>p){o=p}t=true;setTimeout(function(){r()},o)}};s.onerror=s.onclose;s.onmessage=function(u){m.onmessage(u)}}r();this.onopen=function(){};this.onmessage=function(){};this.ondisconnect=function(){};this.onclose=function(){};this.onheartbeat=function(){};this.send=function(u){return s.send(u)};this.close=function(){f=k;s.close()}};return m}})})(jQuery);